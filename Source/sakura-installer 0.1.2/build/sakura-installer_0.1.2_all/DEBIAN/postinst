#!/bin/sh

update-mime-database /usr/share/mime || true
update-desktop-database || true
gtk-update-icon-cache /usr/share/icons/hicolor || true

REAL_USER=$(logname 2>/dev/null)

if [ -n "$REAL_USER" ]; then
    su - "$REAL_USER" -c "
    xdg-mime default sakura-installer.desktop application/vnd.debian.binary-package
    
    CONFIG=\$HOME/.config/mimeapps.list
    mkdir -p \$HOME/.config
    
    if grep -q 'application/vnd.debian.binary-package=' \$CONFIG 2>/dev/null; then
        sed -i 's|application/vnd.debian.binary-package=.*|application/vnd.debian.binary-package=sakura-installer.desktop;|' \$CONFIG
    else
        echo '[Default Applications]' >> \$CONFIG
        echo 'application/vnd.debian.binary-package=sakura-installer.desktop;' >> \$CONFIG
    fi
    "
fi

exit 0
